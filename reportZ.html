<html>
  <head>
    <meta charset="utf-8" />
    <script src="https://unpkg.com/three@0.137.4/build/three.min.js"></script>
    <script src="https://unpkg.com/three@0.137.4/examples/js/controls/OrbitControls.js"></script>
    <script src="https://unpkg.com/three@0.137.4/examples/js/loaders/GLTFLoader.js"></script>
  </head>
<body>
  <h1>pien</h1>
<script>
      // ページの読み込みを待つ
      window.addEventListener('DOMContentLoaded', init);

      function init() {
        // サイズを指定
        const width = 800
        const height = 600;

        // レンダラーを作成
        var renderer = new THREE.WebGLRenderer();
        document.body.appendChild(renderer.domElement);
        renderer.setSize(width, height);
        // レンダラー：シャドウを有効にする
        renderer.shadowMap.enabled = true;
        // 背景の色
        renderer.setClearColor(0x00ffff);

        // シーンを作成
        const scene = new THREE.Scene();
        
        

        // カメラを作成
        const camera = new THREE.PerspectiveCamera(55, width / height);
        camera.position.set(0, 5, 15);

        // カメラコントローラーを作成
        const controls = new THREE.OrbitControls(camera, document.body); 
        
        // 平行光源1
        var directionalLight1 = new THREE.DirectionalLight(0xffffff);
        directionalLight1.castShadow = true; 
        directionalLight1.position.set(5, 30, 5);
        scene.add(directionalLight1);
        
        
        
        // ラピスラズリ読み込み
        var textureLoader1 = new THREE.TextureLoader();
        var texture1 = textureLoader1.load("img/mizuiro.jpg");
        var mat_lapis = new THREE.MeshPhongMaterial();
        mat_lapis.map = texture1;       
        // バンプマップ読み込み
        var bump1 = textureLoader1.load("img/mizuiro.jpg");
        mat_lapis.bumpMap = bump1;
        //mat_lapis.bumpscale = 0.4;
        
        //床
        var planeGeometry = new THREE.PlaneGeometry(30,30);
        var planeMaterial = new THREE.MeshPhongMaterial({ color: 0xc0c0c0 });
        var plane = new THREE.Mesh(planeGeometry,planeMaterial);
        plane.receiveShadow = true;   //影
        plane.rotation.set( -Math.PI/2, 0, 0 );
        plane.position.set(0,-3,0);
        scene.add(plane);
        
        //イルカ
        const loader = new THREE.GLTFLoader();
        var model;
        loader.load('3dmodel/Shark.glb', (gltf) => {
          model = gltf.scene;
          model.castShadow = true; 
          model.scale.set(4,4,4);
          model.position.set(0,2,-3);
          scene.add(model);
        });
        
        
        
        
        /*
        //円柱
        var entyu_g = new THREE.CylinderGeometry( 0.5, 0.5, 6, 16 );
        var entyu = new THREE.Mesh(entyu_g, mat_lapis );
        entyu.position.set(0,0,0);
        scene.add(entyu);
        */
        
        //蝶
        /*
        //体
        var body_g = new THREE.SphereGeometry( 0.15, 32, 32 );
        var mat_w = new THREE.MeshBasicMaterial({ color: 0xffffff });
        var body = new THREE.Mesh( body_g, mat_w);
        body.scale.x =0.2;
        body.scale.y =2;
        body.scale.z =0.2;
        body.castShadow = true; 
        body.position.set(0,0,0);

        //羽
        const shape = new THREE.Shape();
        const x = -2.5;
        const y = -5;
        shape.moveTo(x + 2.5, y + 2.5);
        shape.bezierCurveTo(x + 2.5, y + 2.5, x + 2, y, x, y);
        shape.bezierCurveTo(x - 3, y, x - 3, y + 3.5, x - 3, y + 3.5);
        shape.bezierCurveTo(x - 3, y + 5.5, x - 1.5, y + 7.7, x + 2.5, y + 9.5);
        shape.bezierCurveTo(x + 6, y + 7.7, x + 8, y + 4.5, x + 8, y + 3.5);
        shape.bezierCurveTo(x + 8, y + 3.5, x + 8, y, x + 5, y);
        shape.bezierCurveTo(x + 3.5, y, x + 2.5, y + 2.5, x + 2.5, y + 2.5);
        const extrudeSettings = {
          steps: 2,  // ui: steps
          depth: 0.01,  // ui: depth
          //bevelEnabled: true,  // ui: bevelEnabled
          //bevelThickness: 1,  // ui: bevelThickness
          //bevelSize: 1,  // ui: bevelSize
         // bevelSegments: 2,  // ui: bevelSegments
        };
        var winggeometry = new THREE.ExtrudeGeometry(shape, extrudeSettings);
        var wing1 = new THREE.Mesh(winggeometry, mat_w); 
        wing1.castShadow = true;
        wing1.position.set(-0.1,0,0);
        wing1.rotation.z = -1.5;
        wing1.scale.set(0.06,0.07,0.07);
        wing1.scale.y = 0.02;
        //羽２
        var wing2 = new THREE.Mesh(winggeometry, mat_w); 
        wing2.castShadow = true;
        wing2.position.set(0.1,0,0);
        wing2.rotation.z = 1.5;
        wing2.scale.set(0.06,0.07,0.07);
        wing2.scale.y = 0.02;

        var butterfly = new THREE.Group();
        butterfly.add(wing1);
        butterfly.add(wing2);
        butterfly.add(body);
        butterfly.position.set(-2,0,0);
        butterfly.rotation.x = 0.7;
        butterfly.scale.set(0.5,0.5,0.5);
        scene.add(butterfly);
        */
        
        /*
        //海藻1
        var textureLoader_k1 = new THREE.TextureLoader();  
        var texture_k1 = textureLoader_k1.load("img/kaisou1.png");
        const mat_k1 = new THREE.SpriteMaterial({ map: texture_k1,});
　　　　
        for (let i = 0; i < 5; i++) {
           var k1 = new THREE.Sprite(mat_k1);
           k1.position.x = 3.8 * (Math.random() - 0.5);
           k1.position.y = -2;
           k1.position.z = 4 * (Math.random() - 0.5);
           k1.scale.set(2,2,2);
           k1.scale.y = 4 * (Math.random());
           scene.add(k1);
        }
        
        //海藻2
        var textureLoader_k2 = new THREE.TextureLoader();  
        var texture_k2 = textureLoader_k2.load("img/kaisou2.png");
        const mat_k2 = new THREE.SpriteMaterial({ map: texture_k2,});
　　　　
        for (let i = 0; i < 5; i++) {
           var k2 = new THREE.Sprite(mat_k2);
           k2.position.x = 3.8 * (Math.random() -0.5);
           k2.position.y = -2;
           k2.position.z = 4 * (Math.random() - 0.5);
           k2.scale.set(2,2,2);
           k2.scale.y = 4 * (Math.random());
           scene.add(k2);
        }
        */
        //魚
        var f_body_g = new THREE.SphereGeometry( 0.5, 32, 32 );
        var mat_w = new THREE.MeshBasicMaterial({ color: 0x0000ff });
        var f_body = new THREE.Mesh( f_body_g, mat_w);
        f_body.castShadow = true; 
        f_body.scale.x =2.7;
        f_body.scale.y =1.35;
        f_body.position.set(0,0,0);
        
        var f_teal_g = new THREE.CylinderGeometry( 0.7, 0.7, 0.1, 3 );
        var f_teal = new THREE.Mesh( f_teal_g,mat_w );
        f_teal.castShadow = true; 
        f_teal.rotation.y -= 1.65;
        f_teal.rotation.z += 1.65;
        f_teal.position.set( 1.45, 0, 0 );
        
        var fish = new THREE.Group();
        fish.add(f_body);
        fish.add(f_teal);
        fish.scale.set(0.1,0.1,0.1);
        fish.position.set(0,-2,0);
        
        
        
        //ワイヤーフレーム
        var f_body_wg = new THREE.SphereGeometry( 2, 32, 32 );
        var mat_b_w = new THREE.MeshBasicMaterial({ color: 0x0000ff ,wireframe: true});
        var f_body_w = new THREE.Mesh( f_body_wg, mat_b_w);
        //f_body_w.castShadow = true;
        f_body_w.scale.set(0.1,0.1,0.1);
        f_body_w.position.set(-1.5,2,-3);
        scene.add(f_body_w);
        
        
        
        //操作用
        var i = 1;
        
        update();

        // 毎フレーム時に実行されるループイベントです
        function update(){
          
        if(i >= 6){
          
          scene.remove(fish);
        } else if(i >= 3){
    
          
          scene.add(fish);
        } 
          
        i += 0.01;
          
        if(f_body_w.scale.x <= 3.2){
          f_body_w.scale.x += 0.05;
        }
        if(f_body_w.scale.y <= 1.65){
          f_body_w.scale.y += 0.05;
        }
        if(f_body_w.scale.z <= 1.65){
          f_body_w.scale.z += 0.05;
        }
        
        
          /*
          //羽ばたき
          if(i % 2 <= 1){
            wing1.rotation.y -= 0.05;
            wing2.rotation.y += 0.05;
            body.position.z += 0.003;
          } else if(i % 2 >= 0){
            wing1.rotation.y += 0.05;
            wing2.rotation.y -= 0.05;
            body.position.z -= 0.003;
          }
          i += 0.05;
          */
          
          
          
          
         
          
          // レンダリング
          renderer.render(scene, camera);
          requestAnimationFrame(update);
        }
      }
    </script>
</body>
